<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - Phillip Geo / BareetDesign</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="geoportofolio.png" type="image/png">
</head>
<body>
<header>
  <div class="logo"><a href="index.html" id="site-title" style="text-decoration:none;color:inherit;">Phillip Geo / BareetDesign</a></div>
  <nav>
    <a href="index.html">Projekter</a>
    <a href="about.html">Om</a>
    <a href="contact.html">Kontakt</a>
    <a href="admin.html" class="active">üîí</a>
  </nav>
</header>

<main class="admin-area">
  <h1>Admin Panel</h1>

  <div class="alert-box">
    ‚ö†Ô∏è Advarsel: Hvis du ikke er admin, skal du ikke √¶ndre noget her! <a href="https://phillipgeo.website/index.html">Klik her</a> for at komme tilbage!
  </div>

  <!-- LOGIN -->
  <section id="login-section" class="card">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="login-btn">Login</button>
    <button id="signup-btn">Opret konto</button>
    <p id="login-message"></p>
  </section>

  <!-- DASHBOARD -->
  <section id="admin-section" class="card" style="display:none;">
    <button id="logout-btn">Logout</button>

    <h2>Rediger siteindhold</h2>
    <form id="site-form">
      <label>Site Title:</label>
      <input type="text" id="siteTitle">

      <label>Footer Left:</label>
      <input type="text" id="footerLeft">

      <label>Mail:</label>
      <input type="email" id="contactMail">
      <label>Mail Icon URL:</label>
      <input type="text" id="footerMailIcon">

      <label>Phone:</label>
      <input type="text" id="contactPhone">
      <label>Phone Icon URL:</label>
      <input type="text" id="footerPhoneIcon">

      <label>LinkedIn:</label>
      <input type="text" id="contactLinkedin">
      <label>LinkedIn Icon URL:</label>
      <input type="text" id="footerLinkedinIcon">

      <label>Instagram:</label>
      <input type="text" id="contactInstagram">
      <label>Instagram Icon URL:</label>
      <input type="text" id="footerInstagramIcon">

      <hr style="margin:16px 0; border-color:var(--border);">

      <h3>Intro tekst over projekter</h3>
      <label>Intro Titel:</label>
      <input type="text" id="introTitle">
      <label>Intro Tekst:</label>
      <textarea id="introText" rows="4"></textarea>

      <hr style="margin:16px 0; border-color:var(--border);">

      <h3>Om mig boks</h3>
      <label>Om mig tekst:</label>
      <textarea id="aboutText" rows="5"></textarea>
      <label>Billede URL:</label>
      <input type="text" id="aboutImage">

      <button type="submit">Gem</button>
      <p id="site-message" class="hint"></p>
    </form>

    <h2>Tilf√∏j projekt</h2>
    <form id="project-form">
      <label>Title:</label>
      <input type="text" id="projectTitle">

      <label>Link:</label>
      <input type="text" id="projectLink">

      <label>Billede (URL):</label>
      <input type="text" id="projectImage">

      <button type="submit">Tilf√∏j</button>
      <p id="project-message" class="hint"></p>
    </form>
  </section>
</main>

<footer id="site-footer">
  <div id="footer-left"></div>
  <div id="footer-middle">
    <a id="footer-mail" href="mailto:phillipgeo7@gmail.com">
      <img src="icons/mail.png" class="social-icon" alt="Mail">
      <span>phillipgeo7@gmail.com</span>
    </a>
    <a id="footer-phone" href="tel:+4593956339">
      <img src="icons/phone.png" class="social-icon" alt="Phone">
      <span>+45 93 95 63 39</span>
    </a>
  </div>
  <div id="footer-right">
    <a id="footer-linkedin" href="#" target="_blank">
      <img src="icons/linkedin.png" class="social-icon" alt="LinkedIn">
      <span>LinkedIn</span>
    </a>
    <a id="footer-instagram" href="#" target="_blank">
      <img src="icons/instagram.png" class="social-icon" alt="Instagram">
      <span>Instagram</span>
    </a>
  </div>
</footer>

<div id="copyright">
  <p>&copy; <span id="copyright-text"></span></p>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js";

const SUPABASE_URL = "https://tuogdyemsfdmhxrvmrlq.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR1b2dkeWVtc2ZkbWh4cnZtcmxxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMjQ5OTAsImV4cCI6MjA3MzYwMDk5MH0.yHeM8tkZuzA8PuooVIOrDtdgCTS3jfuXLzQ55-235NU";
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

const loginSection = document.getElementById("login-section");
const adminSection = document.getElementById("admin-section");
const loginMessage = document.getElementById("login-message");
const loginBtn = document.getElementById("login-btn");
const signupBtn = document.getElementById("signup-btn");
const logoutBtn = document.getElementById("logout-btn");
const siteForm = document.getElementById("site-form");
const siteMessage = document.getElementById("site-message");
const projectForm = document.getElementById("project-form");
const projectMessage = document.getElementById("project-message");

// LOGIN
loginBtn.addEventListener("click", async () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const { error } = await supabase.auth.signInWithPassword({ email, password });
  if (error) {
    loginMessage.textContent = "Login fejlede: " + error.message;
  } else {
    loginMessage.textContent = "";
    loginSection.style.display = "none";
    adminSection.style.display = "block";
    loadSiteContent();
  }
});

// SIGNUP
signupBtn.addEventListener("click", async () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const { error } = await supabase.auth.signUp({ email, password });
  if (error) {
    loginMessage.textContent = "Oprettelse fejlede: " + error.message;
  } else {
    loginMessage.textContent = "Bruger oprettet! Login nu.";
  }
});

// LOGOUT
logoutBtn.addEventListener("click", async () => {
  await supabase.auth.signOut();
  loginSection.style.display = "block";
  adminSection.style.display = "none";
});

// LOAD site content
async function loadSiteContent() {
  const { data, error } = await supabase.from("site_content").select("*").eq("id",1).single();
  if(error) return console.error(error);
  if(data){
    // eksisterende felter
    document.getElementById("siteTitle").value = data.siteTitle || "";
    document.getElementById("footerLeft").value = data.footerLeft || "";
    document.getElementById("contactMail").value = data.contactMail || "";
    document.getElementById("contactPhone").value = data.contactPhone || "";
    document.getElementById("contactLinkedin").value = data.contactLinkedin || "";
    document.getElementById("contactInstagram").value = data.contactInstagram || "";
    document.getElementById("footerMailIcon").value = data.footerMailIcon || "";
    document.getElementById("footerPhoneIcon").value = data.footerPhoneIcon || "";
    document.getElementById("footerLinkedinIcon").value = data.footerLinkedinIcon || "";
    document.getElementById("footerInstagramIcon").value = data.footerInstagramIcon || "";

    // nye felter
    document.getElementById("introTitle").value = data.introTitle || "";
    document.getElementById("introText").value = data.introText || "";
    document.getElementById("aboutText").value = data.aboutText || "";
    document.getElementById("aboutImage").value = data.aboutImage || "";

    updateFooterDOM(data);
  }
}

// OPDATER FOOTER-DOM
function updateFooterDOM(data) {
  document.querySelector("#footer-mail img").src = data.footerMailIcon || "icons/mail.png";
  document.querySelector("#footer-phone img").src = data.footerPhoneIcon || "icons/phone.png";
  document.querySelector("#footer-linkedin img").src = data.footerLinkedinIcon || "icons/linkedin.png";
  document.querySelector("#footer-instagram img").src = data.footerInstagramIcon || "icons/instagram.png";

  document.getElementById("footer-mail").href = "mailto:" + (data.contactMail || "phillipgeo7@gmail.com");
  document.getElementById("footer-phone").href = "tel:" + (data.contactPhone || "+4593956339");
  document.getElementById("footer-linkedin").href = data.contactLinkedin || "#";
  document.getElementById("footer-instagram").href = data.contactInstagram || "#";

  document.getElementById("site-title").textContent = data.siteTitle;
  document.getElementById("copyright-text").textContent = data.copyright || "Phillip Geo / BareetDesign";
}

// GEM SITE DATA
siteForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  siteMessage.textContent = "Gemmer...";

  const updates = {
    siteTitle: document.getElementById("siteTitle").value,
    footerLeft: document.getElementById("footerLeft").value,
    contactMail: document.getElementById("contactMail").value,
    contactPhone: document.getElementById("contactPhone").value,
    contactLinkedin: document.getElementById("contactLinkedin").value,
    contactInstagram: document.getElementById("contactInstagram").value,
    footerMailIcon: document.getElementById("footerMailIcon").value,
    footerPhoneIcon: document.getElementById("footerPhoneIcon").value,
    footerLinkedinIcon: document.getElementById("footerLinkedinIcon").value,
    footerInstagramIcon: document.getElementById("footerInstagramIcon").value,
    introTitle: document.getElementById("introTitle").value,
    introText: document.getElementById("introText").value,
    aboutText: document.getElementById("aboutText").value,
    aboutImage: document.getElementById("aboutImage").value
  };

  const { error } = await supabase.from("site_content").update(updates).eq("id",1);
  if (error) {
    siteMessage.textContent = "Fejl ved gem: " + error.message;
  } else {
    siteMessage.textContent = "‚úî Site-indhold gemt!";
    updateFooterDOM(updates);
    setTimeout(()=> siteMessage.textContent="", 3000);
  }
});

// TILF√òJ PROJEKT
projectForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  projectMessage.textContent = "Gemmer projekt...";

  const newProject = {
    title: document.getElementById("projectTitle").value,
    link: document.getElementById("projectLink").value,
    image_url: document.getElementById("projectImage").value,
    created_at: new Date()
  };

  const { error } = await supabase.from("projects").insert([newProject]);
  if (error) {
    projectMessage.textContent = "Fejl ved tilf√∏jelse: " + error.message;
  } else {
    projectMessage.textContent = "‚úî Projekt tilf√∏jet!";
    projectForm.reset();
    setTimeout(()=> projectMessage.textContent="", 3000);
  }
});
</script>
</body>
</html>
